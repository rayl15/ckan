#cloud-config

coreos:
  update:
    reboot-strategy: off
    group: beta
  units:
    - name: amazon-ecs-agent.service
      command: start
      runtime: true
      content: |
        [Unit]
        Description=Amazon ECS Agent
        After=docker.service
        Requires=docker.service

        [Service]
        Environment=ECS_CLUSTER=default
        Environment=ECS_LOGLEVEL=info
        ExecStartPre=-/usr/bin/docker kill ecs-agent
        ExecStartPre=-/usr/bin/docker rm ecs-agent
        ExecStartPre=/usr/bin/docker pull amazon/amazon-ecs-agent
        ExecStart=/usr/bin/docker run --name ecs-agent --env=ECS_CLUSTER=${ECS_CLUSTER} --env=ECS_LOGLEVEL=${ECS_LOGLEVEL} --publish=127.0.0.1:51678:51678 --volume=/var/run/docker.sock:/var/run/docker.sock amazon/amazon-ecs-agent
        ExecStop=/usr/bin/docker stop ecs-agent
        Type=idle
        RestartSec=10s
        Restart=on-failure

ssh_authorized_keys:

